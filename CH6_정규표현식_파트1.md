# 6. 정규표현식 파트 1
- 정규표현식은 지정 가능한 패턴으로, 특수 문자를 사용하여 특정 문자/숫자/단어 의 조합을 표현한다.
- 정규표현식 문법은 다양하고, 파이썬 정규표현식 패키지는 유연한 고급 버전의 펄(Perl) 표준을 따른다.
<br>

## 6.1 정규표현식의 소개
- 간단한 정규표현식의 예시
  - cat : cat과 정확히 일치
  - ca+t : cat, caat, caaat 등 최소 한개 이상의 a가 있는 문자열과 일치
  - ca\\+t : ca+t와 정확히 일치 (이스케이프 시퀀스는 특수문자를 리터럴 문자로 되돌려놓음)
  - ca\*t : ca+t와 유사하나 ct도 포함 (최소 0개 이상의 a가 있는 문자열과 일치)
<br>

## 6.2 실제 예시 : 전화번호
- 전화번호를 검증하는 정규표현식 패턴을 구현한 프로그램 예시
```python
# 정규표현식 패키지 import
import re
# 패턴 앞의 r은 raw string(원시 문자열)을 뜻하는 것으로, r을 쓰지 않아도 동작하긴 하지만 코드의 신뢰성을 위해 쓰는 것이 좋다.
pattern = r'\d\d\d-\d\d\d\d-\d\d\d\d'

s = input('Enter tel. number : ')
if re.match(pattern, s):
  print('Accepted')
else :
  print('Incorrect format')
```
<br>

## 6.3 일치 패턴 정제하기
- re.match 함수는 대상 문자열의 **앞부분**이 패턴과 일치하면 True (문자열 전체가 일치할 필요가 없음)
- 정확히 일치하도록 하려면 문자열의 종료를 의미하는 $를 추가하면 된다.
  - pattern = r'\d\d\d-\d\d\d\d-\d\d\d\d$'
  - re.fullmatch 메서드를 사용하는 방법도 있음
- 다양한 옵션을 주고싶다면, 특정 위치에 여러 개의 값을 허용할 수 있다.
  - \[ab] : 해당 위치에 a 또는 b가 올 수 있지만, ab는 안됨
  - pattern = r'\d\d\d\[ -]\d\d\d\d\[ -]\d\d\d\d$' : 전화번호를 쓸때 빈칸과 빼기 기호 둘 다 허용
<br>

## 6.4 정규표현식 동작 방식: 컴파일 vs 실행
- 정규표현식의 처리 절차
  1. 정규표현식 패턴은 일괄적으로 state machine으로 불리는 series로 컴파일
  2. 일치 유무 판단은 compile time이 아닌 run time에 수행 (runtime 중에 프로그램이 state machine을 순회(traverse)하면서 일치를 찾음)
- compile time과 runtime의 차이점을 명확하게 이해하는 것이 중요!
<br>

- state machinedms 컴파일된 후 runtime에 순회 대상이 된다는 간단한 기본 원칙을 따른다.
- 동일한 정규표현식 패턴을 여러번 사용한다면, 해당 패턴을 먼저 컴파일하여 정규표현식 객체로 만들고 그 객체를 반복사용하는 것이 좋다.
  - 미리 컴파일을 해두면 같은 패턴을 여러번 사용할 때의 코드 실행시간이 줄어든다.
  - regex 패키지는 complie 메서드를 제공한다.
    - re.complie()
<br>

## 6.5 대/소문자 무시하기, 그리고 다른 함수 플래그
- regex 플래그를 사용하여 원하는 조건을 만들 수 있다.
- 2개의 플래그를 2항 or 연산자(|)를 사용하여 조합할 수도 있다.
- 검색, 일치, 컴파일 등을 위한 플래그 요약
  - A : ASCII, 아스키 설정으로 가정
  - I : IGNORECASE, 모든 검색과 일치는 대소문자를 구분하지 않음
  - L : LOCALE, 문자숫자식 (단어 경계와 숫자에 로케일 설정을 반영하여 일치를 찾음)
  - M : MULTILINE, 문자열의 시작과 끝처럼 특수문자 ^과 $는 줄의 시작과 끝을 의미함
  - S : DOTALL, 점 기호(.)는 모든 문자와 일치
  - U : UNICODE, 문자숫자식 (단어 경계와 숫자가 유니코드라는 가정 하에 일치를 찾음)
```python
# re.IGNORECASE는 대/소문자를 무시할 때 사용한다
# re.I로 줄여쓸 수 있다

if re.match('m*ack', 'Mack the knife', re.IGNORECASE):
  print('Success')
```
<br>

## 6.6 정규표현식: 기본 문법 요약
- 메타 문자 : 정규표현식 내에서 특수한 의미를 갖는 문자
- 문자 집합 : 메타 문자와 유사하되, 일치 대상의 집합이 주어진다.
- 표현식 수량자(expression quantifier) : 각 문자를 조합한다. (표현식 특정패턴의 반복 등)
- 그룹 : 소괄호 기호를 사용하면 작은 표현식을 큰 표현식과 조합할 수 있다.
<br>

### 6.6.1 메타 문자
- 정규표현식 메타문자
  - . : 점 기호, 개행 문자를 제외한 임의의 문자 하나와 일치 (DOTALL 플래그와 같이쓰면 모든 문자와 일치)
  - ^ : 캐럿 기호, 문자열의 시작을 의미
  - $ : 문자열의 끝을 의미
  - \A : 문자열의 시작
  - \b : 단어의 경계
  - \B : 비단어(nonword)의 경계
  - \d : 모든 숫자
  - \s : 모든 여백 문자 
  - \S : 여백 문자가 아닌 모든 문자
  - \w : 모든 문자숫자식 문자 또는 언더스코어
  - \W : \w에서 정의한 모든 것을 제외한 문자
  - \z : 문자열의 끝
<br>

### 6.6.2 문자 집합
- \[문자_집합] : 집합 안의 하나의 문자와 일치
- \[^문자_집합] : 집합 안에 존재하지 않는 하나의 문자와 일치
- \- (빼기 기호) : 2개 문자 사이 범위를 구체적으로 표현 (예 : a-d는 abcd이다)
<br>

- 문자 집합의 규칙
  - 대괄호 기호 안의 문자 대부분은 특별한 경우를 제외하면 리터럴로 인식
  - 오른쪽 대괄호 기호는 문자 집합 종료의 의미를 가지므로, 문자 그대로 인식하려면 역슬래시로 이스케이프 시퀀스를 만들어야 함
  - 빼기 기호와 캐럿 기호는 각각 문자의 시작과 끝에 나타나지 않거나 문자의 시작지점에 나타나면 특별한 의미를 갖지만, 그렇지 않을 경우 리터럴로 인식
  - 역슬래시 기호는 반드시 리터럴 문자가 되지 않음 (역슬래시 리터럴을 표현하려면 \\\ 이렇게)  
<br>

### 6.6.3 패턴 수량자
- 모든 수량자는 표현식 지시자(modifier)이지만, 확장자(extender)는 아니다.
- 정규표현식 수량자(greedy) 목록
  - expr\* : expr이 0번 이상 나타남 (빈 문자열과도 일치)
  - expr\+ : expr이 1번 이상 나타남
  - expr? : expr이 0 또는 1번 나타남
  - expr1 \| expr2 : 둘중 하나만 나타남 (둘 다는 안됨)
  - expr{n} : expr이 정확히 n번 나타남
  - expr{m,n} : expr이 최소 m번, 최대 n번 나타남
  - expr{m,} : expr이 최소 m번 나타남
  - expr{,n} : expr이 최대 n번 나타남
  - (expr) : 정규표현식 검사기가 expr을 하나의 그룹으로 인식
  - \\n : 일치된 그룹을 참조함 (\\1은 첫번째 그룹, \\2는 두번째 그룹 과 같은 방식)
<br>

- 간단한 예시로 c(ab)+를 해석해보자.
  - c는 정확하게 일치, ab는 1회 이상 반복되어야 한다는 뜻이 된다.
<br>

### 6.6.4 역추적, 탐욕적 수량자와 게으른 수량자
- 파이썬 정규표현식 검사기는 역추적(backtracking)을 해서라도 최대한 더 많은 일치를 찾는다.
- 예시로 r'c.\*t' 라는 패턴이 있다고 하자. cat은 이 패턴에 일치하는가?
  - 이 패턴을 앞에서부터 문자 그대로 해석한다면 어떻게될까?
  - c와 일치 -> .\*는 모든 패턴의 문자열과 일치하므로 at와 일치 -> t는 찾지 못함이 되지 않을까?
  - 이런 상황에서 역추적을 실행하여 일치 가능한 모든 패턴을 찾아냄
<br>

## 6.7 정규표현식 실습 예시
- 비밀번호가 테스트 조건을 만족하는지 검사하는 함수
  - 조건 1 : 모든 문자는 대문자, 소문자, 숫자, 언더스코어, 또는 구두점문자이다
  - 조건 2 : 최소 길이는 8문자이다
  - 조건 3 : 최소한 글자 1개가 포함되어야 한다
  - 조건 4 : 최소한 숫자 1개가 포함되어야 한다
  - 조건 5 : 최소한 구두점문자 1개가 포함되어야 한다
<br>

- 검증 함수를 정규표현식을 사용해 작성해보면 아래와 같다
```python
import re

# 첫번째 패턴 
# \w는 모든 대소문자+숫자+언더스코어, |는 or의 의미, []안의 문자는 구두점문자 전체 
# 따라서 ()안의 의미는 저 모든 경우의 문자 중 하나이고, {8,}은 최소한 8개 이상을 의미
# $는 문장의 끝 (빈칸 등이 등장하는 것을 방지)
pat1 = r'(\w|[@#$%^&*!]){8,}$'

# 두번째 패턴
# 모든 종류의 문자와 갯수 제한 없이 일치(.*)한 후 하나의 숫자(\d)가 등장해야 함을 의미
pat2 = r'.*\d'

# 세번째 패턴
# 모든 종류의 문자와 갯수 제한 없이 일치(.*)한 후 하나의 대문자 또는 소문자가 등장해야 함을 의미
pat3 = r'.*[a-zA-Z]'

# 네번째 패턴
# 모든 종류의 문자와 갯수 제한 없이 일치(.*)한 후 하나의 구두점문자가 등장해야 함을 의미
pat4 = r'.*[@#$%^&*!]'

def verify_passwd(s):
  b = (re.match(pat1, s) and re.match(pat2, s) and re.match(pat3, s) and re.match(pat4, s))
  return bool(b)
```
<br>

## 6.8 Match 객체 사용하기
- re.match 함수는 대상 문자열이 패턴과 일치하면 match 객체를 반환, 일치하지 않으면 None을 반환한다.
- 전체 패턴에 대한 일치 여부 외에도, 해당 패턴이 소괄호로 나눠진 여러 패턴의 집합이라면 각 부분 패턴의 일치 여부도 알 수 있다.
  - group 메서드 사용
    - group(0)는 정규표현식 패턴에 일치한 전체 텍스트 반환
    - group(n)은 1부터 시작, 소괄호로 나눠진 각 그룹에 일치하는 문자열 일부를 순서대로 반환
  - group이 몇개나 존재하는지 쉽게 아는 방법 : lastindex 메서드
    - 마지막 n(반환한 그룹 중 마지막 그룹이 몇번째 그룹인지)을 정수로 보관
<br>

- match 객체 속성
  - group(n) : 특정 그룹에 속한 텍스트 반환
  - groups() : 일치한 모든 텍스트를 담고 있는 그룹들을 나열한 튜플을 반환
  - groupdict() : 이름이 있는 모든 그룹으로 구성된 딕셔너리를 반환
  - start(n) : 대상 문자열 안에서 n으로 참조할 수 있는 그룹의 시작 지점을 반환
  - end(n) : 전체 대상 문자열에 식별된 그룹의 종료 지점을 반환
  - span(n) : start(n)과 end(n)이 제공하는 정보를 튜플로 반환
  - lastindex : 그룹 중 가장 높은 색인 숫자 
<br>

## 6.9 패턴에 맞는 문자열 검색하기
- 지금까진 패턴에 정확하게 일치하는 텍스트를 찾는 데에만 정규표현식을 사용했지만, 또 다른 기본 용도로는 <b>검색</b>이 있다.
- 일단은 패턴에 맞는 첫번째 문자열만 찾는 방법을 알아보자.
  - 일치_객체 = re.search(패턴, 대상_문자열, flags=0)
  - 이 함수로 일치하는 객체를 찾으면 match 객체를 반환, 그렇지 않을 경우 None을 반환
  - re.match와 동작하는 방식이 비슷하지만, 문자열의 시작부분이 패턴과 일치할 필요가 없다.
<br>

## 6.10 반복하여 검색하기 (findall)
- 특정 패턴과 일치하는 모든 부분 문자열을 찾는 방법을 알아보자.
  - 리스트 = re.findall(패턴, 대상_문자열, flags=0)
  - re.findall의 반환값은 발견한 부분 문자열을 담고 있는 문자열 리스트로, 찾은 순서대로 반환된다.
  - 정규표현식의 검색은 겹치지 않고, 가능한 조건 내에서 가장 긴 문자열을 찾는다.
    - 예를 들어, 숫자로만 이루어진 문자열을 찾을 때 12345가 발견되었다면 1234,234 등을 따로 찾지 않는다.
<br>

## 6.11 findall 메서드와 그룹화 문제
- 그룹화를 문자열에 사용하면 findall 함수는 패턴에 일치하는 각 문자열을 담은 부분 그룹들을 항목으로 하는 리스트를 반환한다.
- 따라서, 원하는 결과를 얻으려면 아래와 같은 트릭이 필요하다.
  - 전체 표현식을 소괄호 안에 넣어 그룹화한다.
  - findall로 반환된 리스트에는 일치한 문자열이 담긴 튜플들이 담겨있는데, 각 튜플의 첫번째 요소를 출력한다. (각 튜플에 대해 튜플\[0]로 인덱싱)
<br>

## 6.12 반복 패턴 검색하기
- 가장 정교한 패턴은 태그가 된 그룹 참조를 포함한다.
- 간단한 예시로는 반복단어를 찾는 검색 패턴이 있다.
  - (w+) \1 : w중 한개 이상으로 나열된 단어와 일치한 후, 다음에 빈칸이 하나 등장한 후 동일한 단어(\1)가 반복되는 것을 찾음
<br> 

## 6.13 텍스트 교체하기
- 특정 패턴과 일치하는 문자열을 다른 패턴으로 교체할 수 있다.
  - re.sub(검색_패턴, 교체_문자열, 대상_문자열, count=0, flags=0)
  - 중복 문자 제거, 공백 길이 조절 등 다양한 문제에 응용 가능하다.














